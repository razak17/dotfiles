#!/bin/zsh

# profiling
zmodload zsh/zprof

# DO not highligh& pasted text
zle_highlight=('paste:none')

# colors
autoload -U colors && colors
#-------------------------------------------------------------------------------
#   LOCAL SCRIPTS
#-------------------------------------------------------------------------------
for script in $ZDOTDIR/scripts/*; do
  source $script
done
#-------------------------------------------------------------------------------
#           SOURCE PLUGINS
#-------------------------------------------------------------------------------
# These should be source *BEFORE* setting up hooks
add_plugin 'zsh-completions'
add_plugin 'zsh-autosuggestions'
add_plugin 'zsh-syntax-highlighting'
add_plugin 'zsh-hist'
add_plugin 'zsh-autopair'
add_plugin 'yarn'
add_completion 'conda-zsh-completion' false
add_completion 'fnm'
autoload zmv # builtin zsh rename command
#-------------------------------------------------------------------------------
#   Modules
#-------------------------------------------------------------------------------
add_modules opts compe hooks binds vim-mode vcs prompt aliases
add_plugin 'git' # Needs to be here b/c it requires compdef (compe)
#-------------------------------------------------------------------------------
#   Plugin Options & Configurations
#-------------------------------------------------------------------------------
ZSH_AUTOSUGGEST_STRATEGY=(match_prev_cmd history completion)
ZSH_AUTOSUGGEST_BUFFER_MAX_SIZE=20
ZSH_AUTOSUGGEST_MANUAL_REBIND=""
ZSH_HIGHLIGHT_HIGHLIGHTERS=(main brackets)
# ignore params
CORRECT_IGNORE="bin"
CORRECT_IGNORE_FILE=".*"
#-------------------------------------------------------------------------------
#   CDR
#-------------------------------------------------------------------------------
# https://github.com/zsh-users/zsh/blob/master/Functions/Chpwd/cdr

zstyle ':completion:*:*:cdr:*:*' menu selection
# $WINDOWID is an environment variable set by kitty representing the window ID
# of the OS window (NOTE this is not the same as the $KITTY_WINDOW_ID)
# @see: https://github.com/kovidgoyal/kitty/pull/2877
zstyle ':chpwd:*' recent-dirs-file $ZSH_CACHE_DIR/.chpwd-recent-dirs-${WINDOWID##*/} +
zstyle ':completion:*' recent-dirs-insert always
zstyle ':chpwd:*' recent-dirs-default yes
#-------------------------------------------------------------------------------
#   PATH
#-------------------------------------------------------------------------------
# fzf
[ -f $HOME/.fzf.zsh ] && source $HOME/.fzf.zsh

# asdf
if exists asdf; then
  fpath+="$ASDF_DIR/completions/"
fi

# fnm
if exists fnm; then
  eval "`fnm env`"
fi

# zoxide
if exists zoxide; then
  eval "$(zoxide init zsh)"
fi

# Azure cli
if exists az; then
  source $HOME/lib/azure-cli/az.completion
fi

# Azure cli
if [[ -e "$HOME/.cargo/env" ]]; then
  source "$HOME/.cargo/env"
fi

# conda_init and pip
conda_init false

# pyenv init
pyenv_init false

path=(
  "$CODELLDB/adapter/"
  "$CODELLDB/lldb/bin"
  "$path[@]"
)

export PATH

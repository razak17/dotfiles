#!/bin/sh

mkdir -p $HOME/.dots

conf() {
	/usr/bin/git --git-dir=$HOME/.dots/dotfiles/ --work-tree=$HOME $@
}

rconf() {
	/usr/bin/git --git-dir=$HOME/.dots/rvim/ --work-tree=$HOME/.config/rvim $@
}

newRawGit() {
	git init --bare $HOME/.dots/dotfiles
	conf config --local status.showUntrackedFiles no
}

importRawGitDotfiles() {
	git clone --bare https://github.com/razak17/dotfiles $HOME/.dots/dotfiles
	conf checkout
	if [ $? = 0 ]; then
		echo "Checked out dotfiles..."
	else
		mkdir -p ~/.config-backup
		echo "Backing up pre-existing dot files."
		conf checkout 2>&1 | grep -E "\s+\." | awk {'print $1'} | xargs -I{} mv {} ~/.config-backup/{}
	fi
	conf checkout
	conf config --local status.showUntrackedFiles no
}

importRawGitNvim() {
	git clone --bare https://github.com/razak17/nvim $HOME/.dots/rvim
	rconf checkout
	if [ $? = 0 ]; then
		echo "Checked out dotfiles..."
	else
		mkdir -p ~/.config-backup-nvim
		echo "Backing up pre-existing dot files."
		rconf checkout 2>&1 | egrep "\s+\." | awk {'print $1'} | xargs -I{} mv {} ~/.config-backup-nvim/{}
	fi
	mkdir -p ~/.config/rvim
	cd ~/.config/rvim || exit
	rconf checkout
	rconf config --local status.showUntrackedFiles no
}

setupUtils() {
	mdkir -p ~/.local/share/rvim
	mdkir -p ~/.cache/rvim
	touch ~/.Xresources
	touch ~/.gtkrc-2.0.mine
	touch ~/.config/zsh/.zshrc
	echo . ~/.config/x11/xresources >~/.Xresources
	echo . ~/.config/zsh/zshrc >~/.config/zsh/.zshrc
}

while [[ "$#" -gt 0 ]]; do
	curr=$1
	shift

	case "$curr" in
	"-a")
		setupUtils
		importRawGitDotfiles
		importRawGitNvim
		;;
	"-dots")
		importRawGitDotfiles
		;;
	"-rvim")
		importRawGitNvim
		;;
	"-utils")
		setupUtils
		;;
	*) echo "Unavailable command... $curr" ;;
	esac
done

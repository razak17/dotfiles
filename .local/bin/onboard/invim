#!/bin/sh

lsp_path='.cache/rvim/nvim_lsp'

cloneRepo() {
	sudo cp "$HOME/.config/nvim/external/bin/rvim" "/usr/local/bin"
}

installLua() {
	cd ~/$lsp_path || exit
	curl -R -O http://www.lua.org/ftp/lua-5.3.6.tar.gz
	tar -zxf lua-5.3.6.tar.gz
	cd lua-5.3.6 || exit
	make linux test
	sudo make install
}

installLuarocks() {
	cd ~/$lsp_path || exit
	wget https://luarocks.org/releases/luarocks-3.3.1.tar.gz
	tar -zxf luarocks-3.3.1.tar.gz
	cd luarocks-3.3.1 || exit
	./configure --with-lua-include=/usr/local/include
	# ./configure --with-lua-include=/usr/include
	make linux
	sudo make install
}

installStyLua() {
	version="0.10.0"
	curl -L https://github.com/johnnymorganz/stylua/releases/latest/download/stylua-${version}-linux.zip -o ~/.dots/stylua-${version}.zip
	cd ~/.dots && ext stylua-${version}.zip || exit
	cd ~/.dots/stylua-${version} && chmod +x ./stylua || exit
	cp --force ./stylua ~/.local/bin
	cd .. && rm stylua-${version}.zip || exit
}

installRocks() {
	luarocks install openssl
	luarocks install luacheck
	luarocks install lua-http-parser
	luarocks install --server=https://luarocks.org/dev luaformatter
}

createDirs

while [[ "$#" -gt 0 ]]; do
	curr=$1
	shift

	case "$curr" in
	"-lua")
		installLua
		installLuarocks
		;;
	"-rocks")
		installRocks
		;;
	"-stylua")
		installStyLua
		;;
	"-all")
		installLua
		installLuarocks
		installRocks
		;;
	*) echo "Unavailable command... $curr" ;;
	esac
done

#!/usr/bin/env bash

installZshPlugins() {
	mkdir -p "$HOME"/.config/zsh/plugins
	mkdir -p "$HOME"/.config/zsh/completion
	plugins=(
		'esc/conda-zsh-completion'
		# 'djui/alias-tips'
		# 'agkozak/zsh-z'
		'zsh-users/zsh-autosuggestions'
		'zsh-users/zsh-completions'
		'zsh-users/zsh-syntax-highlighting'
		'marlonrichert/zsh-hist'
		'hlissner/zsh-autopair'
		'MichaelAquilina/zsh-auto-notify'
		'baliestri/pnpm.plugin.zsh'
	)
	for i in "${plugins[@]}"; do
		name=$(echo "${i}" | sed 's|.*/||')
		if [ "$name" == 'pnpm.plugin.zsh' ]; then
			name="pnpm"
		fi
		if [[ -d "$HOME/.config/zsh/plugins/${name}" ]]; then
			echo "dir ${name} already exists."
		else
			git clone https://github.com/"$i" ~/.config/zsh/plugins/"$name"
		fi
	done

	OH_MY_ZSH="https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/plugins"
	git_dir="$HOME/.config/zsh/plugins/git"
	if [ -e "$git_dir" ]; then
		echo "Done."
		exit
	else
		mkdir -p "$git_dir"
		pushd "$git_dir" || exit
		curl -fsSL $OH_MY_ZSH/git/git.plugin.zsh --output git.plugin.zsh
		curl -fsSL $OH_MY_ZSH/git/README.md --output README.md
	fi
}

installTmuxPlugins() {
	git clone https://github.com/tmux-plugins/tpm "$HOME"/.config/tmux/plugins/tpm
}

installFnm() {
	curl -fsSL https://fnm.vercel.app/install | bash
}

installAsdf() {
	git clone https://github.com/asdf-vm/asdf.git "$HOME"/.asdf --branch v0.10.2
}

installFzf() {
	git clone --depth 1 https://github.com/junegunn/fzf.git "$HOME"/.fzf && "$HOME"/.fzf/install
}

installSuckless() {
	mkdir -p "$HOME"/.dots
	pushd "$HOME"/.dots || exit
	git clone https://github.com/razak17/suckless
	pushd "$HOME"/.dots/suckless/dwm || exit
	sudo make clean install
	pushd "$HOME"/.dots/suckless/dmenu || exit
	sudo make clean install
	pushd "$HOME"/.dots/suckless/dwmblocks || exit
	sudo make clean install
	pushd "$HOME"/.dots/suckless/st || exit
	sudo make clean install
}

installRedis() {
	pushd "$HOME"/Downloads || exit
	wget http://download.redis.io/redis-stable.tar.gz
	tar xvzf redis-stable.tar.gz
	pushd redis-stable || exit
	make
}

installDoas() {
	mkdir -p "$HOME"/.dots
	pushd "$HOME"/.dots || exit
	git clone https://aur.archlinux.org/doas.git
	pushd "$HOME"/.dots/doas || exit
	makepkg -si
}

installYay() {
	mkdir -p "$HOME"/.dots
	pushd "$HOME"/.dots || exit
	git clone https://aur.archlinux.org/yay.git
	pushd "$HOME"/.dots/yay || exit
	makepkg -si
}

while [[ "$#" -gt 0 ]]; do
	curr=$1
	shift

	case "$curr" in
	"-suck")
		installSuckless
		;;
	"-doas")
		installDoas
		;;
	"-yay")
		installYay
		;;
	"-fnm")
		installFnm
		;;
	"-asdf")
		installAsdf
		;;
	"-fzf")
		installFzf
		;;
	"-zsh")
		installZshPlugins
		;;
	"-tmux")
		installTmuxPlugins
		;;
	"-redis")
		installRedis
		;;
	"-all")
		installZshPlugins
		installTmuxPlugins
		installFnm
		installAsdf
		installFzf
		installSuckless
		installRedis
		installDoas
		installYay
		;;
	*) echo "Unavailable command... $curr" ;;
	esac
done

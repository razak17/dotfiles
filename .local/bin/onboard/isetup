#!/bin/sh

setupSsh() {
	if [[ -d "$HOME/.ssh" ]]; then
		chmod 600 ~/.ssh/id_rsa
		eval "$(ssh-agent -s)"
		ssh-add ~/.ssh/id_rsa
	fi
}

# ZSH only and most performant way to check existence of an executable
# https://www.topbug.net/blog/2016/10/11/speed-test-check-the-existence-of-a-command-in-bash-and-zsh/
exists() { (($ + commands[$1])); }

installZshPlugins() {
	mkdir -p ~/.config/zsh/plugins
	mkdir -p ~/.config/zsh/completion
	plugins=(
		'esc/conda-zsh-completion'
		# 'djui/alias-tips'
		'zsh-users/zsh-autosuggestions'
		'zsh-users/zsh-completions'
		'zsh-users/zsh-syntax-highlighting'
		# 'agkozak/zsh-z'
		'marlonrichert/zsh-hist'
	)
	# curl -sLo "https://github.com/$download_path" "$url"
	for i in "${plugins[@]}"; do
		name=$(echo ${i} | sed 's|.*/||')
		if [[ -d "$HOME/.config/zsh/plugins/${name}" ]]; then
			echo "dir ${name} already exists."
		else
			$(git clone https://github.com/$i ~/.config/zsh/plugins/$name)
			echo "clone"
		fi
	done

	mkdir -p ~/.config/zsh/plugins/git
	cd ~/.config/zsh/plugins/git || exit
	curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/plugins/git/git.plugin.zsh --output git.plugin.zsh
	curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/plugins/git/README.md --output README.md
}

installFzf() {
	git clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf && ~/.fzf/install
}
installTmuxPlugins() {
	git clone https://github.com/tmux-plugins/tpm ~/.config/tmux/plugins/tpm
}

installAsdf() {
	git clone https://github.com/asdf-vm/asdf.git ~/.asdf --branch v0.8.0-rc1
}

installFnm() {
	curl -fsSL https://fnm.vercel.app/install | bash
}

installYay() {
	mkdir -p $HOME/.dots
	pushd $HOME/.dots
	git clone https://aur.archlinux.org/yay.git
	pushd $HOME/.dots/yay
	makepkg -si
}

installDoas() {
	mkdir -p $HOME/.dots
	pushd $HOME/.dots
	git clone https://aur.archlinux.org/doas.git
	pushd $HOME/.dots/doas
	makepkg -si
}

installSuckless() {
  mkdir -p $HOME/.dots
  pushd $HOME/.dots
  git clone https://github.com/razak17/suckless
  pushd $HOME/.dots/suckless/dwm
  sudo make clean install
  pushd $HOME/.dots/suckless/dmenu
  sudo make clean install
}

while [[ "$#" -gt 0 ]]; do
	curr=$1
	shift

	case "$curr" in
	"-suck")
		installSuckless
		;;
	"-doas")
		installDoas
		;;
	"-yay")
		installYay
		;;
	"-fnm")
		installFnm
		;;
	"-asdf")
		installAsdf
		;;
	"-fzf")
		installFzf
		;;
	"-zsh")
		installZshPlugins
		;;
	"-tmux")
		installTmuxPlugins
		;;
	"-ssh")
		setupSsh
		;;
	"-all")
		# setupSsh
		installZshPlugins
		installTmuxPlugins
		installFnm
		installAsdf
		installFzf
		installDoas
		installYay
		installSuckless
		;;
	*) echo "Unavailable command... $curr" ;;
	esac
done

#!/bin/sh

setupSsh() {
	if [[ -d "$HOME/.ssh" ]]; then
		chmod 600 $HOME/.ssh/id_rsa
		eval "$(ssh-agent -s)"
		ssh-add $HOME/.ssh/id_rsa
	fi
}

# ZSH only and most performant way to check existence of an executable
# https://www.topbug.net/blog/2016/10/11/speed-test-check-the-existence-of-a-command-in-bash-and-zsh/
exists() { (($ + commands[$1])); }

installZshPlugins() {
	mkdir -p $HOME/.config/zsh/plugins
	mkdir -p $HOME/.config/zsh/completion
	plugins=(
		'esc/conda-zsh-completion'
		# 'djui/alias-tips'
    # 'agkozak/zsh-z'
		'zsh-users/zsh-autosuggestions'
		'zsh-users/zsh-completions'
		'zsh-users/zsh-syntax-highlighting'
		'marlonrichert/zsh-hist'
		'hlissner/zsh-autopair'
		'MichaelAquilina/zsh-auto-notify'
	)
	# curl -sLo "https://github.com/$download_path" "$url"
	for i in "${plugins[@]}"; do
		name=$(echo ${i} | sed 's|.*/||')
		if [[ -d "$HOME/.config/zsh/plugins/${name}" ]]; then
			echo "dir ${name} already exists."
		else
			git clone https://github.com/$i ~/.config/zsh/plugins/$name
		fi
	done

  OH_MY_ZSH="https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/plugins"
  if [ -e "$HOME/.config/zsh/plugins/git" ]; then
    exit
  else
    mkdir -p $HOME/.config/zsh/plugins/git
    pushd $HOME/.config/zsh/plugins/git || exit
    curl -fsSL $OH_MY_ZSH/git/git.plugin.zsh --output git.plugin.zsh
    curl -fsSL $OH_MY_ZSH/git/README.md --output README.md
  fi
}

installFzf() {
	git clone --depth 1 https://github.com/junegunn/fzf.git $HOME/.fzf && $HOME/.fzf/install
}
installTmuxPlugins() {
	git clone https://github.com/tmux-plugins/tpm $HOME/.config/tmux/plugins/tpm
}

installAsdf() {
	git clone https://github.com/asdf-vm/asdf.git $HOME/.asdf --branch v0.8.0-rc1
}

installFnm() {
	curl -fsSL https://fnm.vercel.app/install | bash
}

installYay() {
	mkdir -p $HOME/.dots
	pushd $HOME/.dots || exit
	git clone https://aur.archlinux.org/yay.git
	pushd $HOME/.dots/yay || exit
	makepkg -si
}

installDoas() {
	mkdir -p $HOME/.dots
	pushd $HOME/.dots || exit
	git clone https://aur.archlinux.org/doas.git
	pushd $HOME/.dots/doas || exit
	makepkg -si
}

installSuckless() {
	mkdir -p $HOME/.dots
	pushd $HOME/.dots || exit
	git clone https://github.com/razak17/suckless
	pushd $HOME/.dots/suckless/dwm || exit
	sudo make clean install
	pushd $HOME/.dots/suckless/dmenu || exit
	sudo make clean install
}

while [[ "$#" -gt 0 ]]; do
	curr=$1
	shift

	case "$curr" in
	"-suck")
		installSuckless
		;;
	"-doas")
		installDoas
		;;
	"-yay")
		installYay
		;;
	"-fnm")
		installFnm
		;;
	"-asdf")
		installAsdf
		;;
	"-fzf")
		installFzf
		;;
	"-zsh")
		installZshPlugins
		;;
	"-tmux")
		installTmuxPlugins
		;;
	"-ssh")
		setupSsh
		;;
	"-all")
		# setupSsh
		installZshPlugins
		installTmuxPlugins
		installFnm
		installAsdf
		installFzf
		installDoas
		installYay
		installSuckless
		;;
	*) echo "Unavailable command... $curr" ;;
	esac
done
